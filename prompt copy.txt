ğŸ§  CONTEXTO GENERAL  
Stack tecnolÃ³gico:
- Node.js + TypeScript + Express + Prisma  
- PostgreSQL  
- API oficial de WhatsApp Business  
- AWS (EC2, S3, RDS u otros segÃºn necesidad)

ğŸ“¦ Base de datos multiempresa (multi-tenant):  
- Cada nueva empresa genera tablas dedicadas.  
- Puede usarse un esquema distinto (ej. `company_abc.Customers`) o prefijos (`abc_Customers`).

ğŸ”‘ Tablas principales por empresa:
- Customers  
- Customer_Addresses  
- Products  
- Orders  
- Order_Status  
- Order_History  
- Customer_Sessions  
*(MÃ¡s tablas segÃºn el negocio)*

ğŸ›  Backend:
- Express en TypeScript  
- Integrado con WhatsApp Business API  
- Clean Architecture + SOLID + separaciÃ³n en capas (Controllers, Services, Repositories)  
- Mensajes al usuario final en espaÃ±ol  
- CÃ³digo y docs internas en inglÃ©s

âœ… Validaciones al iniciar:
- Variables de entorno (.env)  
- ConexiÃ³n a PostgreSQL  
- ConexiÃ³n a API de WhatsApp  
- ConexiÃ³n a servicios AWS  
- Webhook y logs configurados

ğŸ¯ OBJETIVO FINAL  
Plataforma backend multiempresa para atenciÃ³n automÃ¡tica por WhatsApp, enfocada en:
- Tiendas de abarrotes  
- VerdulerÃ­as  
- Empresas de agua a domicilio  
- TintorerÃ­as  
- Comercios locales

ğŸ’³ Planes de suscripciÃ³n:
- BÃ¡sico  
- Completo  
- Premium  
*(Limitaciones por plan: volumen de mensajes, productos activos, funcionalidades)*

ğŸ”— Webhook Ãºnico y dinÃ¡mico:
- Un endpoint: `/webhook`  
- IdentificaciÃ³n por `phone_number_id` extraÃ­do del body

ğŸ“š MODELO DE BASE DE DATOS
- basado en los archivos dentro del directorio prisma/central/schema.prisma y prisma/tenant/schema.prisma

ğŸ¤– FLUJO DEL BOT AUTOMÃTICO

ğŸŸ¢ Webhook escucha (POST /webhook):
1. Si nÃºmero nuevo â†’ crear cliente en `Customers`  
2. Si ya existe â†’ ir al menÃº principal

ğŸ“‹ MenÃº principal:
- Ver catÃ¡logo  
- Hacer un pedido  
- Estado de pedido  
- Hablar con un asesor

ğŸ§­ Flujos:
- CatÃ¡logo â†’ Listar productos activos  
- Pedido â†’ Recolectar datos, confirmar y registrar en `Orders`  
- Estado â†’ Buscar Ãºltimo pedido y mostrar estado  
- Asesor â†’ Derivar a un humano

ğŸ“¦ ConfirmaciÃ³n de pedido:
- Crear en `Orders`, enviar resumen, estado inicial  
- Notificar al administrador si se desea

ğŸ•’ Manejo de sesiÃ³n:
- Usar `Customer_Sessions` para persistencia y reanudaciÃ³n de flujo

ğŸ›‘ RECOMENDACIONES ADICIONALES
- Buen manejo de errores â†’ mensajes claros y opciones  
- Middleware para logs y trazabilidad  
- Alertas automÃ¡ticas para monitoreo de fallos (API, pedidos)

Estructura de proyecto
mi-proyecto-chatbot/
â”‚
â”œâ”€â”€ src/                    # CÃ³digo fuente
â”‚   â”œâ”€â”€ controllers/         # LÃ³gica de los endpoints
â”‚   â”œâ”€â”€ services/            # LÃ³gica de negocio
â”‚   â”œâ”€â”€ database/            # LÃ³gica de creacion de tenants bases de datos
â”‚   â”œâ”€â”€ repositories/        # InteracciÃ³n con la base de datos
â”‚   â”œâ”€â”€ models/              # Modelos de datos (tipos de base de datos, entidades)
â”‚   â”œâ”€â”€ middlewares/         # Middleware (logging, validaciones, etc.)
â”‚   â”œâ”€â”€ routes/              # DefiniciÃ³n de rutas
â”‚   â”œâ”€â”€ utils/               # Utilidades auxiliares
â”‚   â””â”€â”€ app.ts               # ConfiguraciÃ³n principal de Express
â”‚
â”œâ”€â”€ .env                    # Variables de entorno
â”œâ”€â”€ tsconfig.json            # ConfiguraciÃ³n de TypeScript
â”œâ”€â”€ package.json             # ConfiguraciÃ³n de NPM
â””â”€â”€ nodemon.json             # ConfiguraciÃ³n de Nodemon


npx prisma generate --schema=prisma/tenant/schema.prisma
npx prisma generate --schema=prisma/central/schema.prisma


ğŸ”¸ Tabla central: `Clients`  
| Campo               | Tipo     | DescripciÃ³n                                      |
|--------------------|----------|--------------------------------------------------|
| id                 | UUID     | ID Ãºnico del cliente (empresa)                  |
| name               | VARCHAR  | Nombre de la empresa                            |
| phone_number_id    | VARCHAR  | ID de WhatsApp Business                         |
| whatsapp_token     | TEXT     | Token de autenticaciÃ³n                          |
| db_connection_config | JSONB  | ConfiguraciÃ³n de base de datos                  |
| plan_type          | VARCHAR  | Plan (bÃ¡sico, completo, premium)                |
| created_at         | TIMESTAMP| Fecha de registro                               |

ğŸ”¸ Tablas por empresa:  
**Customers**  
- id, wa_id, name, phone_number, first_contact_at, created_at  
**Customer_Addresses**  
- id, customer_id, address, is_primary, created_at  
**Products**  
- id, name, description, price, is_active, stock, created_at  
**Orders**  
- id, order_code, customer_id, address_id, total, status, created_at  
**Customer_Sessions**  
- id, customer_id, last_step, expires_at, is_active, created_at



Analiza todo el codigo y directorios de este repositorio en la rama master https://github.com/mariots182/chat-central 

Es un backend multi tenant donde hay una base de datos central y tenants para clientes/empresas que van a contratar mis servicios de un bot para whatsapp, hasta el momento a traves de la ruta '/company' se genera el tenat para cada empresa. Quiero usar la API de Meta para whatsapp business

